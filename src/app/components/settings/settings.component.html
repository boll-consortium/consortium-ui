<app-inner-header [mainTitle]="mainTitle" [subTitle]="subTitle"></app-inner-header>
<div class="row">
  <div class="col-md-offset-0 col-md-8">
    <div class="box">
      <div class="box-header with-border">
        <h3 class="box-title">Institutions on BOLL</h3>
        <div class="box-tools pull-right">
          <div class="has-feedback">
            <input type="text" class="form-control input-sm" placeholder="Search Records">
            <span class="glyphicon glyphicon-search form-control-feedback"></span>
          </div>
        </div>
        <!-- /.box-tools -->
      </div>
      <div class="box-body no-padding">
        <div class="alert alert-info" *ngIf="showMessage">{{message}}</div>
        <table class="table table-bordered table-striped">
          <tr>
            <th style="width: 7%">#</th>
            <th>Institution</th>
            <th>Email</th>
            <th>Blockchain Address</th>
            <th>Status</th>
            <th></th>
          </tr>
          <tbody *ngIf="institutes?.length > 0">
          <tr *ngFor="let institute of institutes; let i = index;">
            <td>{{i+1}}</td>
            <td>
              <a target="_blank" href="{{institute.websiteAddress}}" class="">
              {{institute.name}}
              </a>
            </td>
            <td>
                {{institute.contactEmail}}
            </td>
            <td>{{institute.blockchainAddress}}</td>
            <td><span class="label label-{{institute.verified ? 'success' : 'warning'}}">{{institute.verified ? 'approved' : 'pending'}}</span></td>
            <td>
              <button type="button" class="btn btn-xs btn-{{institute.verified ? 'success' : 'warning'}}"  data-toggle="modal" attr.data-target="#modal-default{{i}}">
                {{institute.verified ? 'Disapprove' : 'Approve'}}
              </button>
              <div class="modal fade" id="modal-default{{i}}">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title">Institute {{institute.verified ? 'Disapproval' : 'Approval'}} Request</h4>
                    </div>
                    <div class="modal-body">
                      <h5 *ngIf="institute.verified">Revoke Authorization of {{institute.name}} to BOLL?</h5>
                      <h5 *ngIf="!institute.verified">Authorize {{institute.name}} to Join BOLL?</h5>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-{{institute.verified ? 'danger' : 'success'}} pull-left"
                      (click)="!institute.verified ? approveRegistration(institute.blockchainAddress, institute.accessToken, i) : null;">
                        <span *ngIf="loading"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...</span>
                        <span *ngIf="!loading">Yes</span>
                      </button>
                      <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                  <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <!-- /.box-body -->
      <div class="box-footer clearfix">
        <ul class="pagination pagination-sm no-margin pull-right" *ngIf="institutes?.length > 0">
          <ng-container>
            <li><a style="disabled: {{(institutes.length/10) < 1}}" href="">&laquo;</a></li>
            <li *ngFor="let pageNumber of (institutes.length/10 | number : 0);"><a routerLink="">{{pageNumber}}</a></li>
            <li><a style="disabled: {{(institutes.length/10) < 1}}" href="">&raquo;</a></li>
          </ng-container>
        </ul>
      </div>
    </div>
    <!-- /.box -->
  </div>
  <app-activity-logger></app-activity-logger>
</div>

