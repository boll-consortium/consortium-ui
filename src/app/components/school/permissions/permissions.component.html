<div class="row py-4 px-5 no-gutters mt-3">
  <div class="col-sm-12 col-md-6">
    <h3 class="font-light">Permissions</h3>
  </div>
  <div class="col-sm-12 col-md-6">
    <ul class="list-inline dl mb-0 float-left float-md-right">
      <li class="list-inline-item text-info mr-3">
        <a href="javascript:void(0)" data-toggle="modal"
           data-target="#modal-default_approve_all">
          <button class="btn btn-circle btn-success text-white">
            <i class="fa fa-check text-white"></i>
          </button>
          <span class="ml-2 font-normal text-dark">Grant All</span>
        </a>
          <div class="modal fade" id="modal-default_approve_all">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title">Grant All Permissions</h4>
                </div>
                <div class="modal-body">
                  <form action="" name="permissionsForm{{i}}" method="post">
                    <div class="form-group has-feedback">
                      <p class="text-red">{{errorMessage}}</p>
                      <p class="text-green">{{successMessage}}</p>
                    </div>
                    <div class="form-group has-feedback">
                      <p class="text-red">Allow <span class="text-bold">{{school.name}}</span> to have these
                        permissions: </p>
                    </div>
                    <div class="panel-group" id="accordion" *ngFor="let actionsType of statements; let i = index;">
                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h4 class="panel-title">
                            <a data-toggle="collapse" class="text-capitalize"
                               data-parent="#accordion" href="#collapse{{i}}">
                              {{actionsType.api}} Events</a>
                          </h4>
                        </div>
                        <div id="collapse{{i}}" class="panel-collapse collapse in">
                          <div class="panel-body">
                            <div class="form-group pl-3" *ngFor="let action of actionsType.actions; let i = index">
                              <p class="text-bold">{{action.label}}</p>
                              <input type="checkbox"
                                     (change)="approveAllCandidates[action.value]['admin'] = !approveAllCandidates[action.value]['admin']"
                                     id="admin_action{{i}}" name="admin_action{{i}}"
                                     [checked]="approveAllCandidates[action.value]['admin'] == undefined">
                              <label class="text-normal" for="admin_action{{i}}">Admin</label>
                              <input type="checkbox" name="write_action{{i}}"
                                     (change)="approveAllCandidates[action.value]['write'] = !approveAllCandidates[action.value]['write']"
                                     id="write_action{{i}}"
                                     [checked]="approveAllCandidates[action.value]['write'] == undefined">
                              <label for="write_action{{i}}">Write</label>
                              <input type="checkbox" name="read_action{{i}}"
                                     (change)="approveAllCandidates[action.value]['read'] = !approveAllCandidates[action.value]['read']"
                                     id="read_action{{i}}"
                                     [checked]="approveAllCandidates[action.value]['read'] == undefined">
                              <label for="read_action{{i}}">Read</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger pull-left"
                          (click)="grantAll(school.blockchainAddress)">
                        <span *ngIf="loading"><span
                          class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...</span>
                    <span *ngIf="!loading">Grant</span>
                  </button>
                  <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                </div>
              </div>
              <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
          </div>
      </li>
    </ul>
  </div>
</div>
<div class="bg-light">
  <div class="border-top manage-table px-4 py-3">
    <div class="title">
      <h3 class="font-light p-4">Approved Permissions</h3>
    </div>
    <div class="row" *ngIf="permissionsInfo?.length > 0">

      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12" *ngFor="let permissionInfo of permissionsInfo; let i = index;">

        <div class="box-card-part text-center no-margin
">

          <div class="title">
            <p>
              <span class="text-bold">Record Type:</span>
              <a target="_blank" href="{{recordInfos[permissionInfo.contractAddress].recordType}}"
                 *ngIf="recordInfos[permissionInfo.contractAddress]" class="text-capitalize">
                {{recordInfos[permissionInfo.contractAddress].recordType.split('/')[recordInfos[permissionInfo.contractAddress].recordType.split('/').length
              - 1]}}
              </a></p>
          </div>
          <div class="user-block">
            <span
              class="description">{{getLastEventOnContract(school.blockchainAddress, permissionInfo.contractAddress)}}</span>
          </div>

          <div class="text">
            <span><span class="text-bold">Permissions: </span><span
              class="text-green text-capitalize">{{permissionInfo.status}}</span> </span>
          </div>
          <div class="text">
            <button type="button" class="btn btn-xs btn-danger" data-toggle="modal"
                    attr.data-target="#modal-default_edit{{i}}">MODIFY ACCESS
            </button>
          </div>
          <div class="modal fade" id="modal-default_edit{{i}}"
               *ngIf="infoToUpdate.approved[permissionInfo.contractAddress] !== null && infoToUpdate.approved[permissionInfo.contractAddress] !== undefined">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title">Modify Permissions</h4>
                </div>
                <div class="modal-body">
                  <form action="" name="permissionsForm{{i}}" method="post">
                    <div class="form-group has-feedback">
                      <p class="text-red">{{errorMessage}}</p>
                      <p class="text-green">{{successMessage}}</p>
                    </div>
                    <div class="form-group has-feedback">
                      <p class="text-red">Allow <span class="text-bold">{{school.name}}</span> to have these
                        permissions: </p>
                    </div>
                    <div class="form-group">
                      <input type="checkbox"
                             [(ngModel)]="infoToUpdate.approved[permissionInfo.contractAddress]['admin']"
                             id="admin{{i}}" name="admin{{i}}">
                      <label for="admin{{i}}">Admin</label>
                    </div>
                    <div class="form-group">
                      <input type="checkbox" name="write{{i}}"
                             [(ngModel)]="infoToUpdate.approved[permissionInfo.contractAddress]['write']"
                             id="write{{i}}">
                      <label for="write{{i}}">Write</label>
                    </div>
                    <div class="form-group">
                      <input type="checkbox" name="read{{i}}"
                             [(ngModel)]="infoToUpdate.approved[permissionInfo.contractAddress]['read']"
                             id="read{{i}}">
                      <label for="read{{i}}">Read</label>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger pull-left"
                          (click)="updatePermissions(school.blockchainAddress, permissionInfo.contractAddress, false)">
                        <span *ngIf="loading"><span
                          class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...</span>
                    <span *ngIf="!loading">Update</span>
                  </button>
                  <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                </div>
              </div>
              <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="border-top manage-table px-4 py-3">
    <div class="title">
      <h3 class="font-light p-4">Pending Permissions</h3>
    </div>
    <div class="row" *ngIf="pendingPermissionsInfo?.length > 0">

      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12"
           *ngFor="let permissionInfo of pendingPermissionsInfo; let i = index;">

        <div class="box-card-part text-center no-margin
">

          <div class="title">
            <p>
              <span class="text-bold">Record Type:</span>
              <a target="_blank" href="{{recordInfos[permissionInfo.contractAddress].recordType}}"
                 *ngIf="recordInfos[permissionInfo.contractAddress]" class="text-capitalize">
                {{recordInfos[permissionInfo.contractAddress].recordType.split('/')[recordInfos[permissionInfo.contractAddress].recordType.split('/').length
              - 1]}}
              </a></p>
          </div>
          <div class="user-block">
            <span
              class="description">{{getLastEventOnContract(school.blockchainAddress, permissionInfo.contractAddress)}}</span>
          </div>

          <div class="text">
            <span><span class="text-bold">Permissions: </span><span
              class="text-green text-capitalize">{{permissionInfo.status}}</span> </span>
          </div>
          <div class="text">
            <button type="button" class="btn btn-xs btn-danger" data-toggle="modal"
                    attr.data-target="#modal-default_edit_p{{i}}">GRANT ACCESS
            </button>
          </div>
          <div class="modal fade" id="modal-default_edit_p{{i}}"
               *ngIf="infoToUpdate.pending[permissionInfo.contractAddress] !== null && infoToUpdate.pending[permissionInfo.contractAddress] !== undefined">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title">Grant Permissions</h4>
                </div>
                <div class="modal-body">
                  <form action="" name="permissionsForm_p{{i}}" method="post">
                    <div class="form-group has-feedback">
                      <p class="text-red">{{errorMessage}}</p>
                      <p class="text-green">{{successMessage}}</p>
                    </div>
                    <div class="form-group has-feedback">
                      <p class="text-red">Allow <span class="text-bold">{{school.name}}</span> to have these
                        permissions: </p>
                    </div>
                    <div class="form-group">
                      <input type="checkbox"
                             [(ngModel)]="infoToUpdate.pending[permissionInfo.contractAddress]['admin']"
                             id="admin_p{{i}}" name="admin_p{{i}}">
                      <label for="admin_p{{i}}">Admin</label>
                    </div>
                    <div class="form-group">
                      <input type="checkbox" name="write_p{{i}}"
                             [(ngModel)]="infoToUpdate.pending[permissionInfo.contractAddress]['write']"
                             id="write_p{{i}}">
                      <label for="write_p{{i}}">Write</label>
                    </div>
                    <div class="form-group">
                      <input type="checkbox" name="read_p{{i}}"
                             [(ngModel)]="infoToUpdate.pending[permissionInfo.contractAddress]['read']"
                             id="read_p{{i}}">
                      <label for="read_p{{i}}">Read</label>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger pull-left"
                          (click)="updatePermissions(school.blockchainAddress, permissionInfo.contractAddress, true)">
                        <span *ngIf="loading"><span
                          class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading...</span>
                    <span *ngIf="!loading">Update</span>
                  </button>
                  <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                </div>
              </div>
              <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
